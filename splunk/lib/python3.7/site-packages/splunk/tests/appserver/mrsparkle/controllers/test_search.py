import unittest
import os
from splunk.appserver.mrsparkle.controllers import search

class TestSearch(unittest.TestCase):
    def setUp(self):
        self.job = search.JobsController()

    def tearDown(self):
        pass

    def test_sanitize_filename(self):
        extensions = [
            'xml',
            'csv',
            'txt',
            'json'
        ]
        sid = "example_sid"
        # test no filename
        for i in range(len(extensions)):
            self.assertEqual(self.job.sanitize_filename(None, sid, extensions[i]), "{}.{}".format(sid, extensions[i]))

        # test generic filename
        filename = 'test'
        for i in range(len(extensions)):
            self.assertEqual(self.job.sanitize_filename(filename, sid, extensions[i]), "{}.{}".format(filename, extensions[i]))

        # test filename with an extension
        filename = 'test.exe'
        for i in range(len(extensions)):
            self.assertEqual(self.job.sanitize_filename(filename, sid, extensions[i]), "{}.{}".format(filename, extensions[i]))
        
        # test sid period character is replaced with an underscore
        sid = "example.sid"
        for i in range(len(extensions)):
            self.assertEqual(self.job.sanitize_filename(None, sid, extensions[i]), 'example_sid.{}'.format(extensions[i]))

    def test_get_xsl_file_meta_data_css(self):
        self.assertFalse(self.job.get_xsl_file_meta_data("tmp.css").get("is_valid_extension"), "check css file")

    def test_get_xsl_file_meta_data_xsl(self):
        self.assertTrue(self.job.get_xsl_file_meta_data("tmp.xsl").get("is_valid_extension"), "check xsl file")

    def test_get_xsl_file_meta_data_xslt(self):
        self.assertTrue(self.job.get_xsl_file_meta_data("tmp.xslt").get("is_valid_extension"), "check xslt file")

    def test_get_xsl_file_meta_data(self):
        self.assertFalse(self.job.get_xsl_file_meta_data("tmp").get("is_valid_extension"), "check without extension")


if __name__ == '__main__':
    unittest.main()
