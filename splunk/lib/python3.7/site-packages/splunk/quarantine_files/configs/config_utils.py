import os
from splunk.rest import simpleRequest, format

def get_all_files_in_dir_recursive(dir):
    all_files = []
    for path, _, files in os.walk(dir):
        for file in files:
            all_files.append(os.path.join(path, file))
    return all_files

def get_quarantine_files_settings(session_key):
    (response, data) = simpleRequest(
        path='/servicesNS/nobody/system/web-features/feature:quarantine_files',
        sessionKey=session_key,
        raiseAllErrors=True
    )
    if response.status == 200:
        parsed_data = format.parseFeedDocument(data)
        return parsed_data.toPrimitive()["feature:quarantine_files"]
    else:
        raise Exception('Failed to get quarantine files settings with status code {}'.format(response.status))
